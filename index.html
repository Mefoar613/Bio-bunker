<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bio-Bunker RPG Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0; padding: 0;
            background-color: #050505; color: #fff;
            font-family: 'Verdana', sans-serif;
            overflow: hidden; touch-action: none; user-select: none;
        }

        /* --- UI –≠–õ–ï–ú–ï–ù–¢–´ --- */
        .screen { display: none; width: 100%; height: 100%; position: absolute; top: 0; left: 0; flex-direction: column; }
        .active { display: flex; }

        /* –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù */
        #screen-game {
            background: radial-gradient(circle at center, #1a2a1a 0%, #000 100%);
            z-index: 1;
        }

        #hud-top {
            position: absolute; top: 0; left: 0; width: 100%;
            padding: 15px; box-sizing: border-box;
            display: flex; justify-content: space-between;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
            pointer-events: none; z-index: 10;
        }
        .hud-val { font-weight: bold; font-size: 18px; text-shadow: 0 0 5px #000; }
        #timer-box { color: #fff; font-size: 24px; }
        .danger-time { color: #f00; animation: pulse-text 0.5s infinite; }

        /* –ò–ì–†–û–í–û–ï –ü–û–õ–ï */
        #game-area {
            flex-grow: 1; position: relative;
            /* –ï—Å–ª–∏ –∫–ª–∏–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (–∫—É–ª–¥–∞—É–Ω), –∫—É—Ä—Å–æ—Ä –º–µ–Ω—è–µ—Ç—Å—è */
        }
        .cooldown-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(255, 0, 0, 0.1);
            pointer-events: none; opacity: 0; transition: opacity 0.1s;
        }

        /* –ö–†–ò–°–¢–ê–õ–õ–´ */
        .crystal {
            position: absolute; width: 60px; height: 60px;
            display: flex; align-items: center; justify-content: center;
            font-size: 40px; transition: transform 0.1s;
            filter: drop-shadow(0 0 5px #0f0);
        }
        .hp-bar {
            position: absolute; bottom: -5px; left: 0; width: 100%; height: 4px;
            background: #333;
        }
        .hp-val { height: 100%; background: #0f0; width: 100%; transition: width 0.1s; }

        /* –≠–§–§–ï–ö–¢–´ */
        .floater {
            position: absolute; font-weight: bold; pointer-events: none;
            animation: floatUp 0.8s forwards; text-shadow: 0 0 3px #000;
        }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-40px) scale(1.5); opacity: 0; } }
        @keyframes pulse-text { 50% { transform: scale(1.1); } }

        /* --- –ú–ê–ì–ê–ó–ò–ù --- */
        #screen-shop { background: #111; z-index: 20; }
        
        .shop-header {
            padding: 20px; text-align: center; background: #000;
            border-bottom: 2px solid #333;
            display: flex; justify-content: space-between; align-items: center;
        }
        
        #shop-list {
            flex-grow: 1; overflow-y: auto; /* –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ */
            padding: 20px;
            display: flex; flex-direction: column; gap: 15px;
            -webkit-overflow-scrolling: touch;
        }

        .skill-group {
            border: 1px solid #333; border-radius: 8px; padding: 10px;
            background: #1a1a1a; margin-bottom: 10px;
        }
        .group-title { color: #888; font-size: 12px; text-transform: uppercase; margin-bottom: 5px; }

        .upgrade-item {
            display: flex; justify-content: space-between; align-items: center;
            background: #222; padding: 15px; border-radius: 8px;
            border: 1px solid #444; margin-bottom: 8px;
        }
        .locked { opacity: 0.5; filter: grayscale(1); pointer-events: none; display: none; } /* –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–∫—Ä—ã—Ç—ã–µ */
        
        .upg-info h3 { margin: 0; font-size: 16px; color: #0f0; }
        .upg-info p { margin: 3px 0 0 0; font-size: 12px; color: #ccc; }
        
        .buy-btn {
            background: #004400; color: #fff; border: 1px solid #0f0;
            padding: 8px 15px; border-radius: 5px; font-weight: bold; font-size: 14px;
        }
        .buy-btn:active { background: #0f0; color: #000; }
        .maxed { background: #333; border-color: #555; color: #888; }

        /* --- –†–ï–ó–£–õ–¨–¢–ê–¢ –†–ê–£–ù–î–ê --- */
        #screen-result {
            background: rgba(0,0,0,0.9); z-index: 30;
            align-items: center; justify-content: center;
        }
        .result-box {
            background: #222; border: 2px solid #0f0; padding: 30px;
            border-radius: 15px; text-align: center; width: 80%;
        }
        .big-btn {
            background: #0f0; color: #000; border: none; padding: 15px 30px;
            font-size: 18px; font-weight: bold; border-radius: 10px; margin-top: 15px; width: 100%;
        }

        /* --- –°–¢–ê–¢–ò–°–¢–ò–ö–ê --- */
        #modal-stats {
            display: none; position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.9); z-index: 50;
            align-items: center; justify-content: center;
        }
        .stats-content {
            background: #111; border: 1px solid #fff; padding: 20px; width: 80%; border-radius: 10px;
        }

    </style>
</head>
<body>

    <div id="screen-game" class="screen active">
        <div id="hud-top">
            <div class="hud-val">–ü–´–õ–¨: <span id="game-dust" style="color:#0f0">0</span></div>
            <div id="timer-box">10.0</div>
        </div>
        
        <div id="cd-layer" class="cooldown-overlay"></div>

        <div id="game-area" onpointerdown="handleTap(event)">
            </div>
    </div>

    <div id="screen-result" class="screen">
        <div class="result-box">
            <h2 id="res-title">–í–†–ï–ú–Ø –í–´–®–õ–û!</h2>
            <p>–°–æ–±—Ä–∞–Ω–æ –ø—ã–ª–∏: <span id="res-dust" style="color:#0f0; font-size:20px;">0</span></p>
            <p id="res-level-info"></p>
            <button class="big-btn" onclick="openShop()">–ú–ê–ì–ê–ó–ò–ù</button>
            <button class="big-btn" style="background:#333; color:#fff; margin-top:10px;" onclick="restartLevel()">–ü–û–í–¢–û–†–ò–¢–¨</button>
        </div>
    </div>

    <div id="screen-shop" class="screen">
        <div class="shop-header">
            <div onclick="showStats()">üìä –ò–Ω—Ñ–æ</div>
            <div>–ë–ê–ù–ö: <span id="shop-dust" style="color:#0f0">0</span></div>
        </div>
        <div id="shop-list">
            </div>
        <div style="padding:20px; background:#000;">
            <button class="big-btn" onclick="goToBattle()">–í –ë–û–ô</button>
        </div>
    </div>

    <div id="modal-stats" onclick="this.style.display='none'">
        <div class="stats-content">
            <h3>–°–¢–ê–¢–ò–°–¢–ò–ö–ê</h3>
            <p>–£—Ä–æ–≤–µ–Ω—å: <span id="stat-lvl">1</span></p>
            <p>–£—Ä–æ–Ω: <span id="stat-dmg">1</span></p>
            <p>–ó–∞–¥–µ—Ä–∂–∫–∞: <span id="stat-cd">0.3</span> —Å–µ–∫</p>
            <p>–í—Ä–µ–º—è: <span id="stat-time">10</span> —Å–µ–∫</p>
            <hr>
            <p>–®–∞–Ω—Å –î–≤–æ–π–Ω–æ–≥–æ —É–¥–∞—Ä–∞: <span id="stat-double">0</span>%</p>
            <p>–®–∞–Ω—Å AOE (–í—Å–µ): <span id="stat-aoe">0</span>%</p>
            <p>–®–∞–Ω—Å –î–≤–æ–π–Ω–æ–π –ø—ã–ª–∏: <span id="stat-luck">0</span>%</p>
            <p>–®–∞–Ω—Å –°—Ç–∏—Ö–∏–∏ (10 —É—Ä–æ–Ω–∞ –≤—Å–µ–º): <span id="stat-elem">0</span>%</p>
            <br>
            <div style="text-align:center; color:#888; font-size:12px;">(–ù–∞–∂–º–∏ —á—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç—å)</div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–û–ö–ê ---
        let player = {
            dust: 0,
            level: 1,
            
            // –ù–∞–≤—ã–∫–∏ (—É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–∫–∞—á–∫–∏)
            speed: 0,     // –°–∫–æ—Ä–æ—Å—Ç—å
            time: 0,      // –í—Ä–µ–º—è
            doubleHit: 0, // –î–≤–æ–π–Ω–æ–π —É–¥–∞—Ä

            strength: 0,  // –°–∏–ª–∞
            greed: 0,     // –ñ–∞–¥–Ω–æ—Å—Ç—å
            aoe: 0,       // –£–¥–∞—Ä –ø–æ –≤—Å–µ–º
            luck: 0,      // –£–¥–∞—á–∞ (–¥–≤–æ–π–Ω–∞—è –ø—ã–ª—å)

            elements: 0   // –°—É–º–º–∞ —É—Ä–æ–≤–Ω–µ–π –≤—Å–µ—Ö —Å—Ç–∏—Ö–∏–π
        };

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–≥—Ä—ã
        const CONFIG = {
            baseCD: 0.3,
            baseTime: 10,
            baseHP: 100,
        };

        // --- –õ–û–ì–ò–ö–ê –ë–û–Ø ---
        let crystals = [];
        let timer = 0;
        let lastTapTime = 0;
        let gameInterval;
        let sessionDust = 0;

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Ä–æ–≤–Ω—è
        function restartLevel() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-game').classList.add('active');
            
            // –†–∞—Å—á–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —É—Ä–æ–≤–Ω—è
            const hp = CONFIG.baseHP + ((player.level - 1) * 200); // 100, 300, 500...
            const time = CONFIG.baseTime + (player.time * 0.5);
            
            timer = time;
            sessionDust = 0;
            document.getElementById('game-dust').innerText = "0";
            
            // –°–ø–∞–≤–Ω –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤
            const area = document.getElementById('game-area');
            area.innerHTML = '';
            crystals = [];
            
            for(let i=0; i<10; i++) {
                const c = document.createElement('div');
                c.className = 'crystal';
                c.innerText = 'üíé'; // –ü–æ—Ç–æ–º –∑–∞–º–µ–Ω–∏–º –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É
                c.style.left = Math.random() * 80 + 10 + '%';
                c.style.top = Math.random() * 80 + 10 + '%';
                
                // HP Bar
                const bar = document.createElement('div');
                bar.className = 'hp-bar';
                const fill = document.createElement('div');
                fill.className = 'hp-val';
                bar.appendChild(fill);
                c.appendChild(bar);

                area.appendChild(c);
                crystals.push({ el: c, fill: fill, hp: hp, maxHp: hp, active: true });
            }

            // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
            clearInterval(gameInterval);
            gameInterval = setInterval(updateTimer, 100);
        }

        function updateTimer() {
            timer -= 0.1;
            const tEl = document.getElementById('timer-box');
            tEl.innerText = timer.toFixed(1);
            
            if(timer <= 3) tEl.classList.add('danger-time');
            else tEl.classList.remove('danger-time');

            if(timer <= 0) {
                endRound(false);
            }
        }

        // –û–ë–†–ê–ë–û–¢–ö–ê –¢–ê–ü–ê
        function handleTap(e) {
            // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ö—É–ª–¥–∞—É–Ω–∞
            const now = Date.now();
            const cd = Math.max(0.05, CONFIG.baseCD - (player.speed * 0.01)) * 1000;
            
            if (now - lastTapTime < cd) {
                // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç "–Ω–µ –≥–æ—Ç–æ–≤–æ"
                const overlay = document.getElementById('cd-layer');
                overlay.style.opacity = 1;
                setTimeout(()=> overlay.style.opacity = 0, 100);
                return;
            }
            lastTapTime = now;
            tg.HapticFeedback.impactOccurred('light');

            // 2. –†–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞
            let damage = 1 + player.strength;
            let hits = 1;

            // –®–∞–Ω—Å –¥–≤–æ–π–Ω–æ–π –∞—Ç–∞–∫–∏
            if (Math.random() * 100 < player.doubleHit) {
                hits = 2;
                showFloat(e.clientX, e.clientY, "x2!", "#ff0");
            }

            // –®–∞–Ω—Å –°—Ç–∏—Ö–∏–π (AOE 10 —É—Ä–æ–Ω–∞)
            let elementalProc = Math.random() * 100 < (player.elements * 0.1);
            // –®–∞–Ω—Å AOE –∞—Ç–∞–∫–∏
            let aoeProc = Math.random() * 100 < (player.aoe * 0.5);

            // 3. –ö–æ–≥–æ –±—å–µ–º? (–ù–∞—Ö–æ–¥–∏–º –∂–∏–≤—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã)
            let liveCrystals = crystals.filter(c => c.active);
            if(liveCrystals.length === 0) return;

            // –ï—Å–ª–∏ AOE –∏–ª–∏ –°—Ç–∏—Ö–∏—è - –±—å–µ–º –≤—Å–µ—Ö
            if (aoeProc || elementalProc) {
                liveCrystals.forEach(c => hitCrystal(c, damage, elementalProc ? 10 : damage));
                showFloat(e.clientX, e.clientY, elementalProc ? "BOOM!" : "AOE!", "#f0f");
            } else {
                // –ë—å–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ (–∏–ª–∏ –±–ª–∏–∂–∞–π—à–µ–≥–æ –∫ –∫–ª–∏–∫—É, –Ω–æ —Ç—É—Ç —Ä–∞–Ω–¥–æ–º –¥–ª—è –≤–µ—Å–µ–ª—å—è)
                // –î–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ –ª—É—á—à–µ –±–∏—Ç—å —Ä–∞–Ω–¥–æ–º–Ω–æ–≥–æ –∂–∏–≤–æ–≥–æ
                for(let i=0; i<hits; i++) {
                    if(liveCrystals.length > 0) {
                        const target = liveCrystals[Math.floor(Math.random() * liveCrystals.length)];
                        hitCrystal(target, damage);
                    }
                }
            }
        }

        function hitCrystal(c, dmg, bonusDmg = 0) {
            if(!c.active) return;
            
            const totalDmg = dmg + bonusDmg;
            c.hp -= totalDmg;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —Ç—Ä—è—Å–∫–∏
            c.el.style.transform = `scale(0.9) rotate(${Math.random()*20-10}deg)`;
            setTimeout(() => c.el.style.transform = 'scale(1) rotate(0deg)', 50);

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–æ—Å–∫—É
            c.fill.style.width = (c.hp / c.maxHp * 100) + '%';

            // –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ —É–¥–∞—Ä (–ü–´–õ–¨)
            let loot = 1;
            // –ñ–∞–¥–Ω–æ—Å—Ç—å (–±–æ–Ω—É—Å –∫ –ª—É—Ç—É) - –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞, —Ç–æ +1
            if(player.greed > 0) loot += 1;
            // –£–¥–∞—á–∞ (–¥–≤–æ–π–Ω–∞—è –ø—ã–ª—å)
            if(Math.random() * 100 < (player.luck * 0.5)) loot *= 2;

            // –ï—Å–ª–∏ —É—Ä–æ–≤–µ–Ω—å 2+, –Ω–∞–≥—Ä–∞–¥–∞ —Ö2
            if(player.level > 1) loot *= 2;

            addDust(loot);

            // –°–º–µ—Ä—Ç—å –∫—Ä–∏—Å—Ç–∞–ª–ª–∞
            if(c.hp <= 0) {
                c.active = false;
                c.el.style.opacity = 0;
                c.el.style.pointerEvents = 'none';
                checkWin();
            }
        }

        function addDust(amount) {
            sessionDust += amount;
            player.dust += amount;
            document.getElementById('game-dust').innerText = sessionDust;
        }

        function checkWin() {
            // –ï—Å–ª–∏ –≤—Å–µ –º–µ—Ä—Ç–≤—ã
            if(crystals.every(c => !c.active)) {
                endRound(true);
            }
        }

        function endRound(win) {
            clearInterval(gameInterval);
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-result').classList.add('active');

            const title = document.getElementById('res-title');
            const info = document.getElementById('res-level-info');
            document.getElementById('res-dust').innerText = sessionDust;

            if(win) {
                title.innerText = "–£–†–û–í–ï–ù–¨ –ó–ê–ß–ò–©–ï–ù!";
                title.style.color = "#0f0";
                info.innerText = "–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å!";
                player.level++; // –ü–æ–≤—ã—à–∞–µ–º —É—Ä–æ–≤–µ–Ω—å
            } else {
                title.innerText = "–í–†–ï–ú–Ø –í–´–®–õ–û";
                title.style.color = "#f00";
                info.innerText = "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –∏–ª–∏ —É–ª—É—á—à–∏—Ç–µ—Å—å.";
            }
            tg.CloudStorage.setItem('save', JSON.stringify(player)); // –°–æ—Ö—Ä–∞–Ω—è–µ–º
        }

        function showFloat(x, y, text, color) {
            const el = document.createElement('div');
            el.className = 'floater';
            el.innerText = text;
            el.style.color = color;
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            document.getElementById('screen-game').appendChild(el);
            setTimeout(()=> el.remove(), 800);
        }

        // --- –ú–ê–ì–ê–ó–ò–ù –ò –ù–ê–í–´–ö–ò ---
        
        // –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
        // type: skill_key, cost_func: (lvl)=>price, max: max_lvl, parent: required_skill_key
        const UPGRADES = [
            // –í–ï–¢–ö–ê 1: –°–ö–û–†–û–°–¢–¨
            { id: 'speed', name: '–°–ö–û–†–û–°–¢–¨', desc: '-0.01 —Å–µ–∫ –∑–∞–¥–µ—Ä–∂–∫–∏', max: 5, cost: l=>(l+1)*10, parent: null },
            { id: 'time', name: '–í–†–ï–ú–Ø', desc: '+0.5 —Å–µ–∫ –∫ —Ç–∞–π–º–µ—Ä—É', max: 5, cost: l=>(l+1)*10 + 10, parent: 'speed' },
            { id: 'doubleHit', name: '–î–í–û–ô–ù–û–ô –£–î–ê–†', desc: '+1% —à–∞–Ω—Å', max: 10, cost: l=>(l+1)*10 + 20, parent: 'time' },

            // –í–ï–¢–ö–ê 2: –°–ò–õ–ê
            { id: 'strength', name: '–°–ò–õ–ê', desc: '+1 –∫ —É—Ä–æ–Ω—É', max: 10, cost: l=>(l+1)*10 + 10, parent: null },
            { id: 'greed', name: '–ñ–ê–î–ù–û–°–¢–¨', desc: '+1 –ø—ã–ª—å –∑–∞ —É–¥–∞—Ä', max: 1, cost: l=>50, parent: 'strength' },
            { id: 'aoe', name: '–£–î–ê–† –ü–û –í–°–ï–ú', desc: '+0.5% —à–∞–Ω—Å', max: 5, cost: l=>(l+1)*20, parent: 'greed' },
            { id: 'luck', name: '–£–î–ê–ß–ê', desc: '+0.5% —à–∞–Ω—Å —Ö2 –ø—ã–ª–∏', max: 5, cost: l=>(l+1)*20, parent: 'aoe' },

            // –í–ï–¢–ö–ê 3: –°–¢–ò–•–ò–ò (11 —à—Ç—É–∫ –ø–æ 30)
            { id: 'elements', name: '–°–¢–ò–•–ò–Ø: –û–ì–û–ù–¨', desc: '+0.1% —à–∞–Ω—Å –í–∑—Ä—ã–≤–∞ (10 —É—Ä–æ–Ω–∞)', max: 11, cost: l=>30, parent: null, label: '–ü–æ–∑–Ω–∞–Ω–∏–µ –°—Ç–∏—Ö–∏–π' }
        ];

        function openShop() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-shop').classList.add('active');
            renderShop();
        }

        function renderShop() {
            const list = document.getElementById('shop-list');
            list.innerHTML = '';
            document.getElementById('shop-dust').innerText = player.dust;

            UPGRADES.forEach(u => {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–¥–∏—Ç–µ–ª—è (–æ—Ç–∫—Ä—ã—Ç –ª–∏ –Ω–∞–≤—ã–∫)
                if(u.parent && player[u.parent] < 1) return; // –ï—Å–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å –Ω–µ –≤–∫–∞—á–∞–Ω, —Å–∫—Ä—ã–≤–∞–µ–º

                const currentLvl = player[u.id];
                const price = u.cost(currentLvl);
                const isMax = currentLvl >= u.max;

                const item = document.createElement('div');
                item.className = 'upgrade-item';
                
                let btnHtml = '';
                if(isMax) {
                    btnHtml = `<button class="buy-btn maxed">MAX</button>`;
                } else {
                    const canBuy = player.dust >= price;
                    btnHtml = `<button class="buy-btn" style="${canBuy?'':'opacity:0.5'}" onclick="buySkill('${u.id}')">${price} üß™</button>`;
                }

                // –î–ª—è —Å—Ç–∏—Ö–∏–π –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–æ–±–æ–µ –∏–º—è
                let nameDisplay = u.name;
                if(u.id === 'elements') nameDisplay = `${u.label} (${currentLvl}/11)`;
                else nameDisplay = `${u.name} (–£—Ä. ${currentLvl})`;

                item.innerHTML = `
                    <div class="upg-info">
                        <h3>${nameDisplay}</h3>
                        <p>${u.desc}</p>
                    </div>
                    ${btnHtml}
                `;
                list.appendChild(item);
            });
        }

        function buySkill(id) {
            const u = UPGRADES.find(x => x.id === id);
            const price = u.cost(player[id]);
            
            if(player.dust >= price && player[id] < u.max) {
                player.dust -= price;
                player[id]++;
                renderShop();
                tg.HapticFeedback.selectionChanged();
            }
        }

        function goToBattle() {
            restartLevel();
        }

        // --- –°–¢–ê–¢–ò–°–¢–ò–ö–ê ---
        function showStats() {
            document.getElementById('modal-stats').style.display = 'flex';
            
            document.getElementById('stat-lvl').innerText = player.level;
            document.getElementById('stat-dmg').innerText = 1 + player.strength;
            
            let cd = Math.max(0.05, CONFIG.baseCD - (player.speed * 0.01));
            document.getElementById('stat-cd').innerText = cd.toFixed(2);
            
            let time = CONFIG.baseTime + (player.time * 0.5);
            document.getElementById('stat-time').innerText = time;

            document.getElementById('stat-double').innerText = player.doubleHit;
            document.getElementById('stat-aoe').innerText = (player.aoe * 0.5).toFixed(1);
            document.getElementById('stat-luck').innerText = (player.luck * 0.5).toFixed(1);
            document.getElementById('stat-elem').innerText = (player.elements * 0.1).toFixed(1);
        }

        // –ó–∞–ø—É—Å–∫
        openShop(); // –°—Ç–∞—Ä—Ç—É–µ–º —Å –º–∞–≥–∞–∑–∏–Ω–∞, —á—Ç–æ–±—ã –∏–≥—Ä–æ–∫ –º–æ–≥ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å

    </script>
</body>
</html>
